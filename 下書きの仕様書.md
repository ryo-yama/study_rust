# リズムゲーム仕様書 (TUI 版 太鼓の達人)

## 1. ゲーム概要

* 太鼓の達人を TUI (Terminal User Interface) で再現したリズムゲーム
* PC キーボードを使用して、音楽に合わせてノーツを叩く
* 太鼓さん次郎形式の譜面データ (`.tja` ファイル) を使用
* 最終的なノルマ達成率に応じてゲームオーバーあり

## 2. ゲーム仕様

### 2.1. 基本仕様

* **ゲームジャンル**: リズムゲーム (太鼓の達人)
* **操作方法**:
  * 赤ノーツ: F, J キー
  * 青ノーツ: D, K キー
  * 連打ノーツ: 上記いずれかのキーを連打
* **ノーツの種類**: 赤ノーツ、青ノーツ、連打ノーツ
* **判定**: Perfect, Good, Bad
* **スコア**: Perfect: 100点, Good: 50点, Bad: -30点, 連打: 1回あたり10点
* **コンボ**: Bad 判定で途切れる
* **ゲームオーバー**: ノルマゲージが80%未満で楽曲が終了した場合
* **楽曲進行**: 自動再生
* **ノーツ速度**: 当面は固定（始点から判定位置まで1秒で移動する速度を想定）、将来的に段階的な速度調整機能を追加予定
* **判定ライン**: 画面左側に設置（Perfect判定範囲：白色枠の四角形、Good判定範囲：一回り大きい四角形）
* **キーコンフィグ**: 固定 (F/J: 赤, D/K: 青)
* **難易度**: 4段階 (Easy, Normal, Hard, Master)。難易度が高いほどノーツ数が増加。速度は楽曲ファイルに依存。

### 2.2. 画面構成

* **タイトル画面**: タイトルロゴ、開始を促すメッセージ（"Press Space to start"）
* **選曲画面**:
  * 楽曲リストを10曲程度表示（スクロール機能あり）
  * 選択中の楽曲をハイライト表示（他のリストより幅広）
  * 曲名、アーティスト名（可能な場合）を表示
  * 楽曲選択後、難易度選択画面へ遷移
* **難易度選択画面**: 選択した楽曲の難易度を階層メニュー形式で表示し、選択可能
* **ロード画面**: 楽曲と譜面データのロード中に表示
* **プレイ画面**:
  * ノーツが流れるレーン（1本）
  * 判定ライン（画面左側）
  * スコア
  * コンボ数
  * ノルマゲージ（80%以上でノルマクリア）
  * 判定結果表示（Perfect, Good, Bad の文字を一時的に表示）
* **結果画面**:
  * 最終スコア
  * プレイ中の最大コンボ数
  * 各判定数 (Perfect, Good, Bad)
  * ノルマ達成の可否
  * ノルマの達成率

### 2.3. アーキテクチャ

* **core_logic**:
  * 譜面データ管理
  * 音楽再生
  * ノーツ判定処理
  * スコア計算
  * コンボ管理
  * ノルマゲージ管理
* **ui (TUI)**:
  * 画面表示 (タイトル、選曲、プレイ、結果)
  * ユーザー入力処理 (キーボード)
  * Ratatui を使用

### 2.4. 開発環境

* **プログラミング言語**: Rust
* **TUI ライブラリ**: Ratatui
* **音楽再生ライブラリ**: rodio (予定)

### 2.5. 開発計画

1.  core_logic の基本機能実装 (譜面解析、判定ロジックなど)
2.  音楽再生機能の実装
3.  ui (TUI) の基本画面実装 (タイトル、選曲)
4.  プレイ画面の実装 (ノーツ表示、キー入力処理、判定表示)
5.  スコア、コンボ、ノルマゲージの実装
6.  結果画面の実装
7.  難易度選択機能の実装
8.  ゲーム全体の調整、デバッグ
9.  機能追加、改善 (速度調整、一時停止など)

### 2.6. 今後の課題

* 将来的な GUI (Bevy) 対応
* キーコンフィグ機能の実装
* 一時停止機能の実装
* リプレイ機能、スコアランキング機能の実装
* AI 譜面生成機能の実装 (将来的な課題)

---

この仕様書は、現時点での開発計画に基づいて作成されています。今後、開発状況や仕様変更に応じて、随時更新される可能性があります。